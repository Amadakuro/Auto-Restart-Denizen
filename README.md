# Документация для администраторов: Скрипт авторестарта сервера на Denizen

## Описание
Этот скрипт автоматически перезапускает сервер Minecraft в заданное время или через определенный интервал после запуска. Он включает уведомления для игроков, команды для управления рестартом и логирование событий. Скрипт оптимизирован для минимальной нагрузки на сервер и удобства использования.

## Установка
1. Убедитесь, что на сервере установлен плагин **Denizen** (скачать можно с [DenizenScript.com](https://denizenscript.com/)).
2. Скопируйте файл `auto_restart.yml` в папку `plugins/Denizen/scripts/`.
3. Перезапустите сервер или выполните команду `/denizen reload` для загрузки скрипта.

## Как работает скрипт?

### Автоматический запуск
- При старте сервера скрипт автоматически устанавливает время рестарта через **1 час** от текущего времени. Например, если сервер запущен в 14:00, рестарт будет в 15:00.
- Каждую секунду скрипт проверяет, сколько времени осталось до рестарта.

### Уведомления игрокам
Игроки получают сообщения перед рестартом:
- **За 5 минут**: "Сервер будет перезагружен через 5 минут."
- **За 1 минуту**: "Сервер будет перезагружен через 1 минуту."
- **За 30 секунд**: "Сервер будет перезагружен через 30 секунд."
- **Перед рестартом**: "Сервер перезагружается сейчас!"

### Перезапуск
- Когда время рестарта наступает, сервер выполняет команду `restart`, перезапускаясь.
- Событие записывается в файл `restart_log.txt` в папке `plugins/Denizen/` с текстом вроде:  
  `[INFO] Сервер перезагружен по расписанию.`.

## Команды для управления

### 1. `/setrestart <HH:MM>`
- **Описание**: Устанавливает точное время рестарта в формате часов и минут (24-часовой формат).
- **Пример**: `/setrestart 23:00` — рестарт будет в 23:00.
- **Права доступа**: Требуется разрешение `denizen.setrestart` (по умолчанию есть у операторов).
- **Особенности**:
  - Если указанное время уже прошло (например, сейчас 23:30, а вы задали 23:00), рестарт переносится на следующий день (23:00 завтра).
  - После выполнения команды вы получите сообщение, например:  
    "Время авторестарта установлено на 23:00".
- **Ошибки**:
  - Если вы ввели неверный формат (например, `/setrestart 25:00` или `/setrestart abc`), появится сообщение:  
    "Неверный формат времени. Используйте HH:MM."

### 2. `/cancelrestart`
- **Описание**: Отменяет запланированный рестарт.
- **Пример**: `/cancelrestart`
- **Права доступа**: Требуется разрешение `denizen.cancelrestart` (по умолчанию есть у операторов).
- **Результат**:
  - Если рестарт был запланирован, вы получите: "Запланированный авторестарт отменен."
  - Если рестарта не было запланировано, вы увидите: "Нет запланированного авторестарта."

## Примеры использования

### Сценарий 1: Установка рестарта на определенное время
1. Выполните: `/setrestart 02:00`.
2. Получите сообщение: "Время авторестарта установлено на 02:00".
3. В 01:55 всем игрокам придет: "Сервер будет перезагружен через 5 минут."
4. В 02:00 сервер перезапустится.

### Сценарий 2: Отмена рестарта
1. После запуска сервера рестарт запланирован на 15:00 (через час).
2. Выполните: `/cancelrestart`.
3. Получите: "Запланированный авторестарт отменен."
4. Сервер продолжит работать без перезапуска.

## Логирование
- Каждый рестарт записывается в файл `restart_log.txt` в папке `plugins/Denizen/`.
- Пример записи:  
  `[INFO] Сервер перезагружен по расписанию. 2025-03-31 02:00:00`
- Это полезно для отслеживания истории рестартов.

## Требования и рекомендации
- **Плагины**: Нужен только Denizen (версия 1.2.0 или новее).
- **Права**: Убедитесь, что у администраторов есть права `denizen.setrestart` и `denizen.cancelrestart` (можно настроить через плагин прав, например, LuckPerms).
- **Рестарт**: Команда `restart` должна быть поддерживаемой вашим сервером (работает в Spigot/Paper). Если используется другой способ рестарта (например, скрипт через консоль), замените `execute as_server "restart"` на нужную команду.

## Устранение неполадок
- **Скрипт не работает**:  
  Проверьте, загружен ли он (`/denizen reload`) и нет ли ошибок в консоли.
- **Рестарт не происходит**:  
  Убедитесь, что команда `restart` работает на вашем сервере (протестируйте вручную в консоли).
- **Сообщения не появляются**:  
  Проверьте синтаксис в файле скрипта — ошибка в YAML (например, лишний пробел) может сломать скрипт.

Если что-то не работает, обратитесь к логам Denizen в `plugins/Denizen/debug.log`.

## Преимущества
- Минимальная нагрузка на сервер.
- Удобные уведомления для игроков.
- Гибкость в управлении временем рестарта.
- Логирование для контроля.

Теперь вы можете легко управлять перезапусками сервера! Если нужны изменения (например, другие интервалы уведомлений), просто сообщите разработчику скрипта.
